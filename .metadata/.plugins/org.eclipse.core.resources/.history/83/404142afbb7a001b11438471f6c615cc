import 'SimplePDL.ecore'

package simplepdl

context ProcessElement
def: process(): Process =
	Process.allInstances()
		->select(p | p.processElements->includes(self))
		->asSequence()->first()

context Process
inv validName('Invalid name: ' + self.name):
	self.name.matches('[A-Za-z_][A-Za-z0-9_]*')
	
context WorkSequence
inv successorAndPredecessorInSameProcess('Activities not in the same process: '
	+ self.predecessor.name + ' in ' + self.predecessor.process().name + ' and '
	+ self.successor.name + ' in ' + self.successor.process().name
):
	self.process() = self.successor.process()
	and self.process() = self.predecessor.process()
	

inv distinctSuccessorAndPredecessor(
	'Successor (' + self.successor.name ') and predecessor (' + self.predecessor.name + ') are the same '
):
	self.predecessor <> self.successor
	
context WorkDefinition
inv uniqueName('Name "' + self.name + '" already exists.'):
	self.process().processElements
	->select(e | e.oclIsKindOf(WorkDefinition))
	->collect(e | e.oclAsType(WorkDefinition))
	->isUnique(name)

endpackage
